apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-file-secret-provider
  namespace: ns-portalxmdrupal
spec:
  provider: azure

  secretObjects:
  - secretName: drup-st-key    # you can rename this later if you want
    type: Opaque
    data:
    - objectName: drupal-storage-name   # KV secret: storage account name
      key: azurestorageaccountname      # K8s secret key
    - objectName: drupal-storage-key    # KV secret: **account key**
      key: azurestorageaccountkey       # K8s secret key EXPECTED by Azure File CSI

  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "false"
    useAzureWorkloadIdentity: "true"

    clientID: "$IDENTITY_CLIENT_ID"
    keyvaultName: "kv-portal-qa-01"
    cloudName: ""
    objects: |
      array:
        - |
          objectName: drupal-storage-name
          objectType: secret
          objectVersion: ""
        - |
          objectName: drupal-storage-key    # ðŸ‘ˆ use KEY, not SAS token
          objectType: secret
          objectVersion: ""
    tenantId: "$IDENTITY_TENANT_ID"
